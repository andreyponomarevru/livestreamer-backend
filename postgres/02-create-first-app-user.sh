#!/bin/bash

echo "Initializing database..."
echo "Create first app user and assign him role ('superadmin'), settings, resource permissions (grant all permissions)"

psql \
  -U "$POSTGRES_USER" \
  -d "$POSTGRES_USER" \
  -c "
    INSERT INTO 
      appuser (role_id, username, password_hash, email, is_email_confirmed, is_deleted) 
    VALUES 
			(1, '$SUPERADMIN_USERNAME', '$SUPERADMIN_PASSWORD', '$SUPERADMIN_EMAIL', true, false);


    INSERT INTO 
      appuser_setting (appuser_id, setting_id, allowed_setting_value_id, unconstrained_value)
    VALUES 
      (1, 1, 1, NULL); 



    INSERT INTO 
      role_resource_permission (role_id, resource_id, permission_id)
    VALUES 
      (1, 1, 1), (1, 1, 2), (1, 1, 3), (1, 1, 4), (1, 1, 5),
      (1, 2, 1), (1, 2, 2), (1, 2, 3), (1, 2, 4), (1, 2, 5),
      (1, 3, 1), (1, 3, 2), (1, 3, 3), (1, 3, 4), (1, 3, 5),
      (1, 4, 1), (1, 4, 2), (1, 4, 3), (1, 4, 4), (1, 4, 5),
      (1, 5, 1), (1, 5, 2), (1, 5, 3), (1, 5, 4), (1, 5, 5),
      (1, 6, 1), (1, 6, 2), (1, 6, 3), (1, 6, 4), (1, 6, 5),
			(1, 7, 1), (1, 7, 2), (1, 7, 3), (1, 7, 4), (1, 7, 5),
			(1, 8, 1), (1, 8, 2), (1, 8, 3), (1, 8, 4), (1, 8, 5),
			(1, 9, 1), (1, 9, 2), (1, 9, 3), (1, 9, 4), (1, 9, 5),
			(1, 10, 1), (1, 10, 2), (1, 10, 3), (1, 10, 4), (1, 10, 5),
			(1, 11, 1), (1, 11, 2), (1, 11, 3), (1, 11, 4), (1, 11, 5),
			(1, 12, 1), (1, 12, 2), (1, 12, 3), (1, 12, 4), (1, 12, 5),
			(1, 13, 1), (1, 13, 2), (1, 13, 3), (1, 13, 4), (1, 13, 5),
			(1, 14, 1), (1, 14, 2), (1, 14, 3), (1, 14, 4), (1, 14, 5);



    INSERT INTO 
      role_resource_permission (role_id, resource_id, permission_id)
    VALUES 
      (2, 1, 1), (2, 1, 2), (2, 1, 3), (2, 1, 4), (2, 1, 5),
      (2, 2, 1), (2, 2, 2), (2, 2, 3), (2, 2, 4), (2, 2, 5),
      (2, 3, 1), (2, 3, 2), (2, 3, 3), (2, 3, 4), (2, 3, 5),
      (2, 4, 1), (2, 4, 2), (2, 4, 3), (2, 4, 4), (2, 4, 5),
      (2, 5, 1), (2, 5, 2), (2, 5, 3), (2, 5, 4), (2, 5, 5),
      (2, 6, 1), (2, 6, 2), (2, 6, 3), (2, 6, 4), (2, 6, 5),
			(2, 7, 1), (2, 7, 2), (2, 7, 3), (2, 7, 4), (2, 7, 5),
			(2, 8, 1), (2, 8, 2), (2, 8, 3), (2, 8, 4), (2, 8, 5),
			(2, 9, 1), (2, 9, 2), (2, 9, 3), (2, 9, 4), (2, 9, 5),
			(2, 10, 1), (2, 10, 2), (2, 10, 3), (2, 10, 4), (2, 10, 5),
			(2, 11, 1), (2, 11, 2), (2, 11, 3), (2, 11, 4), (2, 11, 5),
			(2, 12, 1), (2, 12, 2), (2, 12, 3), (2, 12, 4), (2, 12, 5),
			(2, 13, 1), (2, 13, 2), (2, 13, 3), (2, 13, 4), (2, 13, 5),
			(2, 14, 1), (2, 14, 2), (2, 14, 3), (2, 14, 4), (2, 14, 5);



    INSERT INTO 
      role_resource_permission (role_id, resource_id, permission_id)
    VALUES 
      (3, 2, 2), (3, 2, 4), (3, 2, 5),
      (3, 3, 2), (3, 3, 5),
      (3, 4, 1), (3, 4, 2), (3, 4, 3),
      (3, 5, 2),
      (3, 6, 2),
			(3, 7, 2),
			(3, 9, 2),
			(3, 10, 1), (3, 10, 2), (3, 10, 3),
			(3, 11, 2),
			(3, 12, 1), (3, 12, 2),
			(3, 13, 1), (3, 13, 2), (3, 13, 4),
			(3, 14, 1), (3, 14, 2), (3, 14, 3), (3, 14, 4), (3, 14, 5);
  "